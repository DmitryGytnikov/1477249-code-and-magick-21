(()=>{"use strict";(()=>{const e="https://21.javascript.pages.academy/code-and-magick",t=(e,t)=>{const n=new XMLHttpRequest;return n.responseType="json",n.addEventListener("load",(()=>{switch(n.status){case 200:e(n.response);break;case 400:t("Неверный запрос");break;case 401:t("Пользователь не авторизован");break;case 404:t("Ничего не найдено");break;default:t(`Статус ответа: ${n.status} ${n.statusText}`)}})),n.addEventListener("error",(()=>{t("Произошла ошибка соединения")})),n.addEventListener("timeout",(()=>{t(`Запрос не успел выполниться за ${n.timeout} мс`)})),n.timeout=1e4,n};window.backend={load:(n,o)=>{const r=t(n,o);r.open("GET",`${e}/data`),r.send()},save:(n,o,r)=>{const l=t(o,r);l.open("POST",e),l.send(n)}}})(),(()=>{window.data={WIZARD_COAT_COLORS:["rgb(101, 137, 164)","rgb(241, 43, 107)","rgb(146, 100, 161)","rgb(56, 159, 117)","rgb(215, 210, 55)","rgb(0, 0, 0)"],WIZARD_EYES_COLORS:["black","red","blue","yellow","green"],WIZARD_FIREBALL_COLORS:["#ee4830","#30a8ee","#5ce6c0","#e848d5","#e6e848"],getRandomArrElement:e=>{return e[(0,t=e.length-1,Math.round(Math.random()*(t-0))+0)];var t}};const e=document.querySelector(".setup"),t=e.querySelector(".setup-similar-list"),n=document.querySelector("#similar-wizard-template").content,o=e=>{const t=n.cloneNode(!0);return t.querySelector(".setup-similar-label").textContent=e.name,t.querySelector(".wizard-coat").style.fill=e.colorCoat,t.querySelector(".wizard-eyes").style.fill=e.colorEyes,t},r=function(e){let t=0;return e.colorCoat===window.form.coatColor&&(t+=2),e.colorEyes===window.form.eyesColor&&(t+=1),t};window.updateWizards=()=>{(n=>{const r=n.length>4?4:n.length;t.innerHTML="";const l=document.createDocumentFragment();for(let e=0;e<r;e++)t.appendChild(o(n[e]));t.appendChild(l),e.querySelector(".setup-similar").classList.remove("hidden")})(l.sort(((e,t)=>{let n=r(t)-r(e);return 0===n&&(n=((e,t)=>e>t?1:e<t?-1:0)(e.name,t.name)),n})))};let l=[];window.backend.load((e=>{l=e,window.updateWizards()}),(e=>{const t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center; background-color: red; position: absolute; left: 0; right: 0; font-size: 30px;",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)}))})(),(()=>{const e=document.querySelector(".setup-wizard-appearance"),t=e.querySelector(".wizard-coat"),n=e.querySelector(".wizard-eyes"),o=e.querySelector(".coat-color-input"),r=e.querySelector(".eyes-color-input"),l=document.querySelector(".setup-fireball-wrap"),i=l.querySelector("input"),a=document.querySelector(".setup"),c=a.querySelector(".setup-wizard-form"),d=e=>{let t=null;return(...n)=>{t&&clearTimeout(t),t=setTimeout((()=>{e(...n)}),500)}},s=d((()=>{window.updateWizards()})),u=d((()=>{window.updateWizards()}));window.form={coatColor:"rgb(101, 137, 164)",eyesColor:"black",onCoatClickChange:()=>{const e=window.data.getRandomArrElement(window.data.WIZARD_COAT_COLORS);o.value=e,t.style.fill=e,window.form.coatColor=e,s()},onEyesClickChange:()=>{const e=window.data.getRandomArrElement(window.data.WIZARD_EYES_COLORS);r.value=e,n.style.fill=e,window.form.eyesColor=e,u()},onFireballClickChange:()=>{const e=window.data.getRandomArrElement(window.data.WIZARD_FIREBALL_COLORS);i.value=e,l.style.background=e}};const m=()=>{a.classList.add("hidden")},y=function(e){const t=document.createElement("div");t.style="z-index: 200; margin: 0 auto; text-align: center; background-color: green; position: absolute; left: 0; right: 0; font-size: 40px; color: black;",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)};c.addEventListener("submit",(e=>{window.backend.save(new FormData(c),m,y),e.preventDefault()}))})(),(()=>{const e=(e,t,n,o)=>{e.fillStyle=o,e.beginPath(),e.moveTo(t,n),e.lineTo(t+15,n+135),e.lineTo(t,n+270),e.lineTo(t+210,n+270-15),e.lineTo(t+420,n+270),e.lineTo(t+420-15,n+135),e.lineTo(t+420,n),e.lineTo(t+210,n+15),e.closePath(),e.fill()};window.renderStatistics=(t,n,o)=>{e(t,110,20,"rgba(0, 0, 0, 0.7)"),e(t,100,10,"#fff"),t.fillStyle="#000",t.font="16px PT Mono",t.fillText("Ура вы победили!",120,35),t.fillText("Список результатов:",120,55);const r=(e=>{if(0===e.length)return!1;{let t=e[0];for(let n=0;n<e.length-1;n++)e[n+1]>t&&(t=e[n+1]);return t}})(o);for(let e=0;e<n.length;e++){const l=Math.round(150*o[e]/r);t.fillStyle="#000",t.fillText(n[e],160+90*e,260),t.fillText(Math.round(o[e]),160+90*e,230-l),"Вы"===n[e]?t.fillStyle="rgba(255, 0, 0, 1)":t.fillStyle=`hsl(240, ${Math.round(100*Math.random())}%, 50%)`,t.fillRect(160+90*e,240-l,40,l)}}})(),(()=>{const e=document.querySelector(".setup-user-name");e.addEventListener("input",(()=>{const t=e.value.length;t<2?e.setCustomValidity(`Ещё ${2-t} симв.`):t>25?e.setCustomValidity(`Удалите лишние ${t-25} симв.`):e.setCustomValidity(""),e.reportValidity()}))})(),(()=>{const e=document.querySelector(".setup-open"),t=document.querySelector(".setup"),n=document.querySelector(".setup"),o=n.querySelector(".setup-close"),r=n.querySelector(".wizard-coat"),l=n.querySelector(".wizard-eyes"),i=n.querySelector(".setup-fireball-wrap"),a={x:t.style.left,y:t.style.top},c=()=>{t.style.left=a.x,t.style.top=a.y,n.classList.remove("hidden"),document.addEventListener("keydown",d),r.addEventListener("click",window.form.onCoatClickChange),l.addEventListener("click",window.form.onEyesClickChange),i.addEventListener("click",window.form.onFireballClickChange)},d=e=>{"Escape"===e.key&&(e.preventDefault(),s())},s=()=>{n.classList.add("hidden"),document.removeEventListener("keydown",d),r.removeEventListener("click",window.form.onCoatClickChange),l.removeEventListener("click",window.form.onEyesClickChange),i.removeEventListener("click",window.form.onFireballClickChange)};e.addEventListener("click",(()=>{c()})),e.addEventListener("keydown",(e=>{"Enter"===e.key&&c()})),o.addEventListener("click",(()=>{s()})),o.addEventListener("keydown",(e=>{"Enter"===e.key&&s()}))})(),(()=>{const e=document.querySelector(".setup"),t=e.querySelector(".upload");t.addEventListener("mousedown",(function(n){n.preventDefault();let o={x:n.clientX,y:n.clientY},r=!1;const l=function(t){t.preventDefault(),r=!0;const n=o.x-t.clientX,l=o.y-t.clientY;o={x:t.clientX,y:t.clientY},e.style.left=e.offsetLeft-n+"px",e.style.top=e.offsetTop-l+"px"},i=function(e){if(e.preventDefault(),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",i),r){const e=function(n){n.preventDefault(),t.removeEventListener("click",e)};t.addEventListener("click",e)}};document.addEventListener("mousemove",l),document.addEventListener("mouseup",i)}))})()})();
